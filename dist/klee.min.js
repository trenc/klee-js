var S="0.5.8";function C(m){return{debugLevel:0,responsive:!0,renderer:{type:"WebGLRenderer",args:[{antialias:!0,preserveDrawingBuffer:!0,alpha:!0}],domElement:"body",clearColor:"#000000",opacity:1,properties:{shadowMap:{enabled:!0,type:m.PCFSoftShadowMap}}},camera:{type:"PerspectiveCamera",methods:{lookAt:[0,0,0]},properties:{position:{x:-1,y:2,z:5},name:"camera-1",fov:35,aspect:window.innerWidth/window.innerHeight,near:1,far:300}},scene:{type:"Scene",properties:{name:"scene-1",position:{x:0,y:0,z:0}}}}}var g=class{static merge(c,r){if(!r||typeof r!="object")return c;for(let o of Object.keys(r))r[o]instanceof Object&&typeof c[o]!="undefined"&&Object.assign(r[o],this.merge(c[o],r[o]));return Object.assign(c||{},r),c}static isThreeColorValue(c){return["color","specular","emissive","diffuse","background","sheen"].includes(c)}static applyMethods(c,r){r=r||{};for(let o in r){let t=Array.isArray(r[o])?r[o]:[];o in c?c[o](...t):console.log("Applied object has no method: "+o)}return c}};var e=function(){let m={},c,r={canvas:null,camera:null,renderer:null,scene:null,mouse:null,raycaster:null,manager:null,controls:{OrbitControls:null},movingLimits:null,draggables:[],draggableObject:null,collidables:[],actions:{isDragging:!1}};function o(i,d={}){(!i||!i.REVISION)&&f("THREE is not inserted"),c={...i},(!d||typeof d!="object")&&(d={},y("Options are set to default values")),m={...g.merge(C(c),d)},r.renderer=l(m.renderer),r.manager=new c.LoadingManager}function t(i){r.renderer.render(r.scene,r.camera),r.controls.OrbitControls&&(r.controls.OrbitControls.enableDamping||r.controls.OrbitControls.autoRotate)&&r.controls.OrbitControls.update(),typeof i=="function"&&i(),requestAnimationFrame(()=>t(i))}function n(){let i=m.responsive||!1,d=r.camera.fov,p=r.canvas.clientWidth,h=r.canvas.clientWidth,O=r.canvas.clientHeight;if(r.renderer.setSize(h,O),r.camera.aspect=h/O,r.camera.updateProjectionMatrix(),i===!1)return;new ResizeObserver(P=>{let M=window.innerWidth;h=r.canvas.clientWidth,O=r.canvas.clientHeight,M!==h&&(r.renderer.setSize(M,O),r.camera.aspect=M/O,r.camera.fov=d*p/M,r.camera.updateProjectionMatrix())}).observe(document.querySelector("body"))}function l(i){r.domElement=document.querySelector(i.domElement),r.domElement instanceof HTMLCanvasElement&&(i.args.canvas=r.domElement,r.canvas=r.domElement);let d=a(i);return d=s(d,i.properties),d.setClearColor(new c.Color(i.clearColor),i.opacity),d.setPixelRatio(window.devicePixelRatio),r.canvas||(r.domElement.appendChild(d.domElement),r.canvas=d.domElement),d.setSize(r.canvas.clientWidth,r.canvas.clientHeight),d}function a(i){let d=Array.isArray(i.args)?i.args:[];return new c[i.type](...d)}function s(i,d){return g.merge(i,d)}function u(i,d){let p=m.debugLevel!==void 0?m.debugLevel:3;switch(d){case"error":throw i;case"warn":p>0&&console.warn(i);break;case"info":p>2&&console.info(i);break;default:p>1&&console.log(i);break}}function f(i){u(i,"error")}function y(i){u(i,"warn")}function w(i){u(i,"log")}function E(i){u(i,"info")}return{get canvas(){return r.canvas},get options(){return m},get THREE(){return c},get scene(){return r.scene},set scene(i){r.scene=i},get camera(){return r.camera},set camera(i){r.camera=i},get controls(){return r.controls},get renderer(){return r.renderer},get manager(){return r.manager},get collidables(){return r.collidables},set collidables(i){r.collidables=i},get draggableObject(){return r.draggableObject},set draggableObject(i){r.draggableObject=i},get draggables(){return r.draggables},set draggables(i){r.draggables=i},get mouse(){return r.mouse},set mouse(i){r.mouse=i},get movingLimits(){return r.movingLimits},set movingLimits(i){r.movingLimits=i},get raycaster(){return r.raycaster},set raycaster(i){r.raycaster=i},get actions(){return r.actions},initSize:n,create:a,error:f,warn:y,log:w,info:E,init:o,run:t}}();var v=function(){function m(o){o||(o={type:"MeshPhongMaterial",args:[{color:16777215}]},e.info("No options for material given, using default MeshPhongMaterial in white"));let t=e.create(o);return t=c(t,o),t}function c(o,t){let n=e.THREE;return t.properties&&(o=r(o,t.properties)),t.methods&&(o=g.applyMethods(o,t.methods)),t.textures&&(t.textures.forEach(async l=>{let a=l.loader||"TextureLoader",s=new n[a](e.manager),u=l.map,f=await s.loadAsync(l.url);o[u]=f,l.properties&&(o[u]=r(o[u],l.properties)),l.methods&&(o[u]=g.applyMethods(o,l.methods))}),o.needsUpdate=!0),o}function r(o,t){let n=e.THREE;if(!t||typeof t!="object")return o;for(let l in t)t[l]instanceof Object?o[l]={...t[l]}:g.isThreeColorValue(l)?o[l]=new n.Color(t[l]):o[l]=t[l];return o}return{create:m,change:c}}(e);var T=function(){function m(n,l){let a={collidable:s=>t(n,s),draggable:s=>o(n,s),dragMaterial:s=>r(n,s),movingLimiter:s=>c(n,s)};for(let s in l)a[s]&&a[s](s);n.userData={...n.userData,...l}}function c(n,l){let a=e.THREE,s=new a.Box3;s.setFromObject(n),e.movingLimits={min:s.min,max:s.max}}function r(n,l){}function o(n,l){l&&e.draggables.push(n)}function t(n,l){l&&e.collidables.push(n)}return{handle:m}}(e);var b=function(){function m(t){let n=c(t);return e.scene.add(n),n}function c(t){let n=e.THREE,l=Array.isArray(t.args)?t.args:[],a=new n[t.type](...l);return a=r(a,t),a}function r(t,n){return n.properties&&(t=o(t,n.properties)),n.methods&&(t=g.applyMethods(t,n.methods)),t}function o(t,n){let l=e.THREE;if(!n||typeof n!="object")return t;for(let a in n)if(n[a]instanceof Object)if(typeof t[a]!="undefined"&&"copy"in t[a]){if("toVector3"in t[a]&&"setFromVector3"in t[a]){let u=new l.Vector3;u.setFromEuler(t[a]);let f={...u,...n[a]};t[a].setFromVector3(f)}let s={...t[a],...n[a]};t[a].copy(s)}else a==="userData"?T.handle(t,n[a]):t[a]=o(t[a],n[a]);else g.isThreeColorValue(a)?t[a]=new l.Color(n[a]):t[a]=n[a];return t}return{add:m,create:c,change:r}}(e);var L=function(){function m(){let t=e.options;e.camera=r(t.camera),e.scene=c(t.scene),e.initSize()}function c(t){let n=b.create(t);return(async()=>{n.background=await o(t.background),n.environment=await o(t.environment)})(),n}function r(t){let n=b.create(t);return n.updateProjectionMatrix(),n}async function o(t){if(!t)return null;let n=e.THREE,l=t.loader||"TextureLoader";return await new n[l](e.manager).loadAsync(t.url)}return{init:m}}(e);var A=function(){function m(r,o){e.controls[r.name]=c(r,o)}function c(r,o){let t=new r(e.camera,e.renderer.domElement);return t=b.change(t,o),t}return{init:m}}(e);var D=function(){let m={};function c(o){m[o.name]=new o(e.manager)}async function r(o){return await m[o.loader].loadAsync(o.url)}return{init:c,load:r}}(e);var H=function(){function m(t){return b.create(t)}function c(t,n){return t=b.change(t,n),t}function r(t){if(typeof t=="object"&&t.type)return o(t);let n=[];return Array.isArray(t)&&t.forEach(l=>{let a=o(l);n.push(a)}),n}function o(t){let n=m(t);return e.scene.add(n),n}return{add:r,create:m,change:c}}(e);var R=function(){function m(c){c||(c={type:"BoxGeometry",args:[1,1,1]},e.info("No options for geometry given, using default BoxGeometry 1x1x1"));let r=e.create(c);return r=g.merge(r,c.properties),r}return{create:m}}(e);var j=function(){function m(a){let s=e.THREE,u=v.create(a.material),f=R.create(a.geometry),y=new s.Mesh(f,u);return y=n(y,a),y}function c(a){if(typeof a=="object"){if(a.loader)return r(a);if(a.geometry)return t(a)}let s=[];return Array.isArray(a)&&a.forEach(u=>{let f=c(u);s.push(f)}),s}async function r(a){let s=await D.load(a);if(s.scene){let u=o(s.scene,a);return u=n(u,a),u.receiveShadow=!1,u.castShadow=!1,e.scene.add(u),u}else return s=n(s,a),e.scene.add(s),s}function o(a,s){let u=e.THREE,f=new u.Box3().setFromObject(a),y=f.getCenter(new u.Vector3),w=.001,E={x:f.max.x-f.min.x+w,y:f.max.y-f.min.y+w,z:f.max.z-f.min.z+w},i=new u.BoxGeometry(E.x,E.y,E.z);s.material||(s.material={color:16777215,transparent:!0,opacity:0});let d=new u.MeshBasicMaterial(s.material),p=new u.Mesh(i,d);return p.position.y=E.y/2,a.position.x+=a.position.x-y.x,a.position.y+=a.position.y-y.y,a.position.z+=a.position.z-y.z,p.renderOrder=1,a.traverse(h=>{h.isMesh&&(h.receiveShadow=s.properties.receiveShadow||!1,h.castShadow=s.properties.castShadow||!1,h.material.side=u.DoubleSide)}),p.add(a),p}function t(a){let s=m(a);return e.scene.add(s),s}function n(a,s){return a=b.change(a,s),s.material&&v.change(a.material,s.material),a}function l(a){e.collidables=e.collidables.filter(s=>s!==a),e.draggables=e.draggables.filter(s=>s!==a),e.scene.remove(a)}return{add:c,create:m,change:n,remove:l}}(e);var x=function(){let tmpMaterial=null,plane=null,planeNormal=null,pointIntersect=null,distance=null;function init(){let m=e.THREE;plane=new m.Plane,planeNormal=new m.Vector3(0,1,0),pointIntersect=new m.Vector3,distance=new m.Vector3}function start(){let intersects=e.raycaster.intersectObjects(e.draggables);if(intersects.length<=0)return;pointIntersect.copy(intersects[0].point),plane.setFromNormalAndCoplanarPoint(planeNormal,pointIntersect),distance.subVectors(intersects[0].object.position,intersects[0].point),e.draggableObject=intersects[0].object,e.controls.OrbitControls.enabled=!1,e.actions.isDragging=!0,e.canvas.style.cursor="grab";let onDragStartCallback=e.draggableObject.userData?.callbacks?.onDragStart??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDragStart=="string"&&(onDragStartCallback=eval(e.draggableObject.userData.callbacks.onDragStart)),onDragStartCallback(e),e.draggableObject.userData.dragMaterial&&(tmpMaterial=e.draggableObject.material,e.draggableObject.material=v.create(e.draggableObject.userData.dragMaterial))}function stop(){if(e.controls.OrbitControls.enabled=!0,e.actions.isDragging=!1,e.canvas.style.cursor="auto",e.draggableObject){let onDragStopCallback=e.draggableObject.userData?.callbacks?.onDragStop??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDragStop=="string"&&(onDragStopCallback=eval(e.draggableObject.userData.callbacks.onDragStop)),onDragStopCallback(e)}e.draggableObject&&e.draggableObject.userData.dragMaterial&&(e.draggableObject.material=tmpMaterial,tmpMaterial=null),e.draggableObject=null}function drag(){e.actions.isDragging&&(e.draggableObject.position.addVectors(pointIntersect,distance),e.movingLimits!==null&&(e.movingLimits.min.y=e.draggableObject.position.y,e.movingLimits.max.y=e.draggableObject.position.y,e.draggableObject.position.clamp(e.movingLimits.min,e.movingLimits.max)),e.raycaster.ray.intersectPlane(plane,pointIntersect))}return{init,start,drag,stop}}();var k=function(){async function m(){let t=e.THREE;e.raycaster=e.raycaster??new t.Raycaster,e.mouse=e.mouse??{},x.init(e.draggables);let n=await e.renderer.domElement;n.addEventListener("mousemove",l=>{o(l)}),n.addEventListener("mousedown",l=>{c(l)}),n.addEventListener("mouseup",l=>{r(l)})}function c(t){x.start()}function r(){x.stop()}function o(t){let n=e.canvas.getBoundingClientRect();e.mouse.x=(t.clientX-n.left)/(n.right-n.left)*2-1,e.mouse.y=-((t.clientY-n.top)/(n.bottom-n.top))*2+1,e.raycaster.setFromCamera(e.mouse,e.camera),x.drag()}return{init:m}}();var z=function(){function m(c){let r=e.THREE,o=!1,t=new r.Box3().setFromObject(c);return e.collidables.forEach(n=>{if(n===c)return;let l=new r.Box3().setFromObject(n);t.intersectsBox(l)&&(o=!0)}),o}return{check:m}}(e);console.log("klee.js: "+S);export{e as App,z as Collision,A as Controls,x as Dragging,k as Events,R as Geometry,j as Item,S as KLEEVERSION,H as Light,D as Loaders,v as Material,b as Object3d,L as Scene};
//# sourceMappingURL=klee.min.js.map
