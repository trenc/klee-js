var M="0.8.3";function H(u){return{debugLevel:0,responsive:!0,renderer:{type:"WebGLRenderer",args:[{antialias:!0,preserveDrawingBuffer:!0,alpha:!0}],domElement:"body",clearColor:"#000000",opacity:1,properties:{shadowMap:{enabled:!0,type:u.PCFSoftShadowMap}}},camera:{type:"PerspectiveCamera",methods:{lookAt:[0,0,0]},properties:{position:{x:-1,y:2,z:5},name:"camera-1",fov:35,aspect:window.innerWidth/window.innerHeight,near:1,far:300}},scene:{type:"Scene",properties:{name:"scene-1",position:{x:0,y:0,z:0}}}}}var p=class{static merge(s,t){if(!t||typeof t!="object")return s;for(let o of Object.keys(t))t[o]instanceof Object&&typeof s[o]<"u"&&Object.assign(t[o],this.merge(s[o],t[o]));return Object.assign(s||{},t),s}static isThreeColorValue(s){return["color","specular","emissive","diffuse","background","sheen"].includes(s)}static applyMethods(s,t){t=t||{};for(let o in t){let r=Array.isArray(t[o])?t[o]:[];o in s?s[o](...r):console.log("Applied object has no method: "+o)}return s}};var e=function(){let u={},s,t={canvas:null,camera:null,renderer:null,scene:null,mouse:null,raycaster:null,manager:null,controls:{OrbitControls:null},movingLimits:null,draggables:[],draggableObject:null,collidables:[],actions:{isDragging:!1}};function o(i,g={}){(!i||!i.REVISION)&&f("THREE is not inserted"),s={...i},(!g||typeof g!="object")&&(g={},d("Options are set to default values")),u={...p.merge(H(s),g)},t.renderer=l(u.renderer),t.manager=new s.LoadingManager}function r(i){t.renderer.render(t.scene,t.camera),t.controls.OrbitControls&&(t.controls.OrbitControls.enableDamping||t.controls.OrbitControls.autoRotate)&&t.controls.OrbitControls.update(),typeof i=="function"&&i(),requestAnimationFrame(()=>r(i))}function a(){let i=u.responsive||!1,g=t.camera.fov,y=t.canvas.clientWidth,h=t.canvas.clientWidth,O=t.canvas.clientHeight;if(t.renderer.setSize(h,O),t.camera.aspect=h/O,t.camera.updateProjectionMatrix(),i===!1)return;new ResizeObserver(F=>{let D=window.innerWidth;h=t.canvas.clientWidth,O=t.canvas.clientHeight,D!==h&&(t.renderer.setSize(D,O),t.camera.aspect=D/O,t.camera.fov=g*y/D,t.camera.updateProjectionMatrix())}).observe(document.querySelector("body"))}function l(i){t.domElement=document.querySelector(i.domElement),t.domElement instanceof HTMLCanvasElement&&(i.args.canvas=t.domElement,t.canvas=t.domElement);let g=n(i);return g=m(g,i.properties),g.setClearColor(new s.Color(i.clearColor),i.opacity),g.setPixelRatio(window.devicePixelRatio),t.canvas||(t.domElement.appendChild(g.domElement),t.canvas=g.domElement),g.setSize(t.canvas.clientWidth,t.canvas.clientHeight),g}function n(i){let g=Array.isArray(i.args)?i.args:[];return new s[i.type](...g)}function m(i,g){return p.merge(i,g)}function c(i,g){let y=u.debugLevel!==void 0?u.debugLevel:3;switch(g){case"error":throw i;case"warn":y>0&&console.warn(i);break;case"info":y>2&&console.info(i);break;default:y>1&&console.log(i);break}}function f(i){c(i,"error")}function d(i){c(i,"warn")}function b(i){c(i,"log")}function x(i){c(i,"info")}return{get canvas(){return t.canvas},get options(){return u},get THREE(){return s},get scene(){return t.scene},set scene(i){t.scene=i},get camera(){return t.camera},set camera(i){t.camera=i},get controls(){return t.controls},get renderer(){return t.renderer},get manager(){return t.manager},get collidables(){return t.collidables},set collidables(i){t.collidables=i},get draggableObject(){return t.draggableObject},set draggableObject(i){t.draggableObject=i},get draggables(){return t.draggables},set draggables(i){t.draggables=i},get mouse(){return t.mouse},set mouse(i){t.mouse=i},get movingLimits(){return t.movingLimits},set movingLimits(i){t.movingLimits=i},get raycaster(){return t.raycaster},set raycaster(i){t.raycaster=i},get actions(){return t.actions},initSize:a,create:n,error:f,warn:d,log:b,info:x,init:o,run:r}}();var R=function(){function u(r,a){let l={collidable:n=>o(r,n),draggable:n=>t(r,n),movingLimiter:n=>s(r,n)};for(let n in a)a[n]&&l[n]&&l[n](n);r.userData={...r.userData,...a}}function s(r,a){let l=e.THREE,n=new l.Box3;n.setFromObject(r),e.movingLimits={min:n.min,max:n.max}}function t(r,a){a&&e.draggables.push(r)}function o(r,a){a&&e.collidables.push(r)}return{handle:u}}(e);var E=function(){function u(r){let a=s(r);return e.scene.add(a),a}function s(r){let a=e.THREE,l=Array.isArray(r.args)?r.args:[],n=new a[r.type](...l);return n=t(n,r),n}function t(r,a){return a.properties&&(r=o(r,a.properties)),a.methods&&(r=p.applyMethods(r,a.methods)),r}function o(r,a){let l=e.THREE;if(!a||typeof a!="object")return r;for(let n in a)if(a[n]instanceof Object)if(typeof r[n]<"u"&&"copy"in r[n]){if("setFromVector3"in r[n]){let c=new l.Vector3;c.setFromEuler(r[n]);let f={...c,...a[n]};r[n].setFromVector3(f)}let m={...r[n],...a[n]};r[n].copy(m)}else n==="userData"?R.handle(r,a[n]):r[n]=o(r[n],a[n]);else p.isThreeColorValue(n)?r[n]=new l.Color(a[n]):r[n]=a[n];return r}return{add:u,create:s,change:t}}(e);var S=function(){function u(){let r=e.options;e.camera=t(r.camera),e.scene=s(r.scene),e.initSize()}function s(r){let a=E.create(r);return(async()=>(a.background=await o(r.background),a.environment=await o(r.environment)))(),a}function t(r){let a=E.create(r);return a.updateProjectionMatrix(),a}async function o(r){if(!r)return null;let a=e.THREE,l=r.loader||"TextureLoader";return await new a[l](e.manager).loadAsync(r.url)}return{init:u}}(e);var L=function(){function u(t,o){e.controls[t.name]=s(t,o)}function s(t,o){let r=new t(e.camera,e.renderer.domElement);return r=E.change(r,o),r}return{init:u}}(e);var T=function(){let u={};function s(o){u[o.name]=new o(e.manager)}async function t(o){return await u[o.loader].loadAsync(o.url)}return{init:s,load:t}}(e);var A=function(){function u(r){return E.create(r)}function s(r,a){return r=E.change(r,a),r}function t(r){if(typeof r=="object"&&r.type)return o(r);let a=[];return Array.isArray(r)&&r.forEach(l=>{let n=o(l);a.push(n)}),a}function o(r){let a=u(r);return e.scene.add(a),a}return{add:t,create:u,change:s}}(e);var v=function(){function u(o){o||(o={type:"MeshPhongMaterial",args:[{color:16777215}]},e.info("No options for material given, using default MeshPhongMaterial in white"));let r=e.create(o);return r=s(r,o),r}function s(o,r){let a=e.THREE;return r.properties&&(o=t(o,r.properties)),r.methods&&(o=p.applyMethods(o,r.methods)),r.textures&&(r.textures.forEach(async l=>{let n=l.loader||"TextureLoader",m=new a[n](e.manager),c=l.map,f=await m.loadAsync(l.url);o[c]=f,l.properties&&(o[c]=t(o[c],l.properties)),l.methods&&(o[c]=p.applyMethods(o,l.methods))}),o.needsUpdate=!0),o}function t(o,r){let a=e.THREE;if(!r||typeof r!="object")return o;for(let l in r)r[l]instanceof Object?o[l]={...r[l]}:p.isThreeColorValue(l)?o[l]=new a.Color(r[l]):o[l]=r[l];return o}return{create:u,change:s}}(e);var C=function(){function u(s){s||(s={type:"BoxGeometry",args:[1,1,1]},e.info("No options for geometry given, using default BoxGeometry 1x1x1"));let t=e.create(s);return t=p.merge(t,s.properties),t}return{create:u}}(e);var z=function(){function u(n){let m=e.THREE,c=v.create(n.material),f=C.create(n.geometry),d=new m.Mesh(f,c);return d=a(d,n),d}function s(n){if(typeof n=="object"){if(n.loader)return t(n);if(n.geometry)return r(n)}let m=[];return Array.isArray(n)&&n.forEach(c=>{let f=s(c);m.push(f)}),m}async function t(n){let m=await T.load(n);if(m.scene){let c=o(m.scene,n);return c=a(c,n),c.receiveShadow=!1,c.castShadow=!1,e.scene.add(c),c}else return m=a(m,n),e.scene.add(m),m}function o(n,m){let c=e.THREE,f=new c.Box3().setFromObject(n),d=f.getCenter(new c.Vector3),b=.001,x={x:f.max.x-f.min.x+b,y:f.max.y-f.min.y+b,z:f.max.z-f.min.z+b},i=new c.BoxGeometry(x.x,x.y,x.z);m.material||(m.material={color:16777215,transparent:!0,opacity:0});let g=new c.MeshBasicMaterial(m.material),y=new c.Mesh(i,g);return y.position.y=x.y/2,n.position.x+=n.position.x-d.x,n.position.y+=n.position.y-d.y,n.position.z+=n.position.z-d.z,y.renderOrder=1,n.traverse(h=>{h.isMesh&&(h.receiveShadow=m.properties.receiveShadow||!1,h.castShadow=m.properties.castShadow||!1,h.material.side=c.DoubleSide)}),y.add(n),y}function r(n){let m=u(n);return e.scene.add(m),m}function a(n,m){return n=E.change(n,m),m.material&&v.change(n.material,m.material),n}function l(n){e.collidables=e.collidables.filter(m=>m!==n),e.draggables=e.draggables.filter(m=>m!==n),e.scene.remove(n)}return{add:s,create:u,change:a,remove:l}}(e);var w=function(){let u=null,s=null,t=null,o=null,r=null;function a(){let c=e.THREE;s=new c.Plane,t=new c.Vector3(0,1,0),o=new c.Vector3,r=new c.Vector3}function l(){let c=e.THREE,f=e.raycaster.intersectObjects(e.draggables);if(f.length<=0)return;o.copy(f[0].point),s.setFromNormalAndCoplanarPoint(t,o),r.subVectors(f[0].object.position,f[0].point),e.draggableObject=f[0].object;let d=new c.Box3().setFromObject(e.draggableObject),b=new c.Vector3;d.getSize(b),e.draggableObject.userData.tmp={bbox:d,size:b},e.controls.OrbitControls.enabled=!1,e.actions.isDragging=!0,e.canvas.style.cursor="grab";let x=e.draggableObject.userData?.callbacks?.onDragStart??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDragStart=="string"&&(x=new Function("return "+e.draggableObject.userData.callbacks.onDragStart)()),x(e),e.draggableObject.userData.dragMaterial&&(u=e.draggableObject.material,e.draggableObject.material=v.create(e.draggableObject.userData.dragMaterial))}function n(){if(e.controls.OrbitControls.enabled=!0,e.actions.isDragging=!1,e.canvas.style.cursor="auto",e.draggableObject){let c=e.draggableObject.userData?.callbacks?.onDragStop??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDragStop=="string"&&(c=new Function("return "+e.draggableObject.userData.callbacks.onDragStop)()),c(e)}e.draggableObject&&e.draggableObject.userData.dragMaterial&&(e.draggableObject.material=u,u=null),e.draggableObject=null}function m(){let c=e.THREE;if(!e.actions.isDragging)return;if(e.draggableObject.position.addVectors(o,r),e.movingLimits!==null){let d={min:new c.Vector3,max:new c.Vector3};d.min.y=e.draggableObject.position.y,d.max.y=e.draggableObject.position.y;let b=e.draggableObject.userData.tmp.size;d.min.x=e.movingLimits.min.x+b.x/2,d.max.x=e.movingLimits.max.x-b.x/2,d.min.z=e.movingLimits.min.z+b.z/2,d.max.z=e.movingLimits.max.z-b.z/2,e.draggableObject.position.clamp(d.min,d.max)}let f=e.draggableObject.userData?.callbacks?.onDrag??(()=>{});typeof e.draggableObject.userData?.callbacks?.onDrag=="string"&&(f=new Function("return "+e.draggableObject.userData.callbacks.onDrag)()),f(e),e.raycaster.ray.intersectPlane(s,o)}return{init:a,start:l,drag:m,stop:n}}();var j=function(){async function u(){let r=e.THREE;e.raycaster=e.raycaster??new r.Raycaster,e.mouse=e.mouse??{},w.init(e.draggables);let a=await e.renderer.domElement;a.addEventListener("mousemove",l=>{o(l)}),a.addEventListener("mousedown",l=>{s(l)}),a.addEventListener("mouseup",l=>{t(l)})}function s(r){w.start()}function t(){w.stop()}function o(r){let a=e.canvas.getBoundingClientRect();e.mouse.x=(r.clientX-a.left)/(a.right-a.left)*2-1,e.mouse.y=-((r.clientY-a.top)/(a.bottom-a.top))*2+1,e.raycaster.setFromCamera(e.mouse,e.camera),w.drag()}return{init:u}}();var k=function(){let u=[];function s(o,r=!0){let a=e.THREE,l=!1,n=new a.Box3().setFromObject(o);return u.length=0,e.collidables.forEach(m=>{if(m===o||r&&!m.visible)return;let c=new a.Box3().setFromObject(m);n.intersectsBox(c)&&(u.push(m),l=!0)}),l}function t(){return u}return{check:s,getCurrentCollisions:t}}(e);console.log("klee.js: "+M);export{e as App,k as Collision,L as Controls,w as Dragging,j as Events,C as Geometry,z as Item,M as KLEEVERSION,A as Light,T as Loaders,v as Material,E as Object3d,S as Scene,R as UserData};
//# sourceMappingURL=klee.min.js.map
